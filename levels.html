<!--
  aPuzzle | RS PROJECT [ nightcoreat ]
-->

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ¬ aPuzzle - Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù„ØºØ§Ø²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles/game-ui.css" />
  <link rel="stylesheet" href="styles/levelStyle.css" />
</head>
<body>
  <h1>ğŸ§© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù„ØºØ§Ø²</h1>
  <div class="currency-card">
  ğŸ’° Ø¹Ù…Ù„Ø§ØªÙƒ: <span id="coins">0</span>
  <button onclick="location.href='shop.html'">ğŸ›’ Ù…ØªØ¬Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª</button>
  </div>

  <div class="levels-grid" id="levels-list"></div>

  <script src="scripts/levels.js"></script>
  <script>
  const coinsEl = document.getElementById("coins");
  const list = document.getElementById("levels-list");

  let coins = parseInt(localStorage.getItem("coins") || "500");
  coinsEl.textContent = coins;

  const progress = new Set(JSON.parse(localStorage.getItem("puzzleProgress") || "[]"));

  function updateCoinsDisplay() {
    coinsEl.textContent = coins;
  }

  // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø£ÙˆÙ„Ø§
  fetch("assets/shop.json")
    .then(res => res.json())
    .then(shopItems => {
      renderLevels(shopItems);
    });

  function renderLevels(shopItems) {
    list.innerHTML = "";

    levels.forEach(level => {
      const shopItem = shopItems.find(item => item.type === "level" && item.levelId === level.id);
      const price = shopItem ? shopItem.price : 0;

      const isProgressUnlocked = progress.has(level.id);
      const isShopUnlocked = localStorage.getItem(`unlocked_level_${level.id}`) === "true";
      const isUnlocked = level.id === 1 || isProgressUnlocked || isShopUnlocked;

      const card = document.createElement("div");
      card.className = "level-card";
      if (!isUnlocked) card.classList.add("locked");

      card.innerHTML = `
        <img src="${level.image}" alt="preview">
        <h3>${level.name}</h3>
        <p>ğŸ§© ${level.width} Ã— ${level.height}</p>
      `;

      const btn = document.createElement("button");

      if (isUnlocked) {
        btn.textContent = "ğŸš€ Ø§Ø¨Ø¯Ø£";
        btn.onclick = () => {
          window.location.href = `play.html?level=${level.id}`;
        };
      } else if (isShopUnlocked) {
        btn.textContent = "ğŸ›’ Ø´Ø±Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±";
        btn.disabled = true;
      } else {
        btn.textContent = `ğŸ”“ Ø§ÙØªØ­ Ø¨Ù€ ${price} Ø¹Ù…Ù„Ø© Ù…Ù† Ù…ØªØ¬Ø± Ø§Ù„Ø£Ø¯ÙˆØ§Øª`;
        btn.onclick = () => {
          if (coins >= price) {
            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ ÙØªØ­ Ù‡Ø°Ø§ Ø§Ù„Ù„ØºØ² Ø¨Ù€ ${price} Ø¹Ù…Ù„Ø©ØŸ`)) {
              coins -= price;
              updateCoinsDisplay();
              localStorage.setItem("coins", coins);
              progress.add(level.id);
              localStorage.setItem("puzzleProgress", JSON.stringify([...progress]));
              renderLevels(shopItems);
            }
          } else {
            alert("âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ø¹Ù…Ù„Ø§Øª ÙƒØ§ÙÙŠØ©.");
          }
        };
      }

      card.appendChild(btn);

      if (!isUnlocked) {
        const overlay = document.createElement("div");
        overlay.className = "locked-overlay";
        overlay.textContent = "ğŸ”’ Ù…Ù‚ÙÙ„";
        card.appendChild(overlay);
      }

      list.appendChild(card);
    });
  }
</script>

</body>
</html>
